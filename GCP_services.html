  <!DOCTYPE html>
  <html lang="en">
  <body>
  <script src="https://unpkg.com/gojs@2.3.16/release/go.js"></script>
   
  <div id="allSampleContent" class="p-4 w-full">
    <script id="code">
    function init() {

      // Since 2.2 you can also author concise templates with method chaining instead of GraphObject.make
      // For details, see https://gojs.net/latest/intro/buildingObjects.html
      const $ = go.GraphObject.make;  // for conciseness in defining templates

      myDiagram =
        new go.Diagram("myDiagramDiv",  // must name or refer to the DIV HTML element
          {
            allowCopy: false,
            allowDelete: false,
            draggingTool: $(CustomDraggingTool),
            layout: $(CustomLayout),
            // enable undo & redo
            "undoManager.isEnabled": true
          });

      // define the Node template
      myDiagram.nodeTemplate =
        $(go.Node, "Auto",
          new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
          // define the node's outer shape, which will surround the TextBlock
          $(go.Shape, "RoundedRectangle",
            {
              fill: "rgb(254, 201, 0)", stroke: "black", parameter1: 20,  // the corner has a large radius
              portId: "", fromSpot: go.Spot.AllSides, toSpot: go.Spot.AllSides
            }),
          $(go.TextBlock,
            new go.Binding("text", "text").makeTwoWay())
        );

      myDiagram.nodeTemplateMap.add("Super",
        $(go.Node, "Auto",
          { locationObjectName: "BODY" },
          $(go.Shape, "RoundedRectangle",
            {
              fill: "rgba(128, 128, 64, 0.5)", strokeWidth: 1.5, parameter1: 20,
              spot1: go.Spot.TopLeft, spot2: go.Spot.BottomRight, minSize: new go.Size(30, 30)
            }),
          $(go.Panel, "Vertical",
            { margin: 10 },
            $(go.TextBlock,
              { font: "bold 10pt sans-serif", margin: new go.Margin(0, 0, 5, 0) },
              new go.Binding("text")),
            $(go.Shape,
              { name: "BODY", opacity: 0 })
          )
        ));

      // replace the default Link template in the linkTemplateMap
      myDiagram.linkTemplate =
        $(go.Link,  // the whole link panel
          { routing: go.Link.Orthogonal, corner: 10 },
          $(go.Shape,  // the link shape
            { strokeWidth: 1.5 }),
          $(go.Shape,  // the arrowhead
            { toArrow: "Standard", stroke: null })
        );

      // read in the JSON-format data from the "mySavedModel" element
      load();
    }

  // A custom layout that sizes each "Super" node to be big enough to cover all of it member nodes
  class CustomLayout extends go.Layout {
    doLayout(coll) {
      coll = this.collectParts(coll);

      const supers = new go.Set(/*go.Node*/);
      coll.each(p => {
        if (p instanceof go.Node && p.category === "Super") supers.add(p);
      });

      function membersOf(sup, diag) {
        const set = new go.Set(/*go.Part*/);
        const arr = sup.data._members;
        for (let i = 0; i < arr.length; i++) {
          const d = arr[i];
          set.add(diag.findNodeForData(d));
        }
        return set;
      }

      function isReady(sup, supers, diag) {
        const arr = sup.data._members;
        for (let i = 0; i < arr.length; i++) {
          const d = arr[i];
          if (d.category !== "Super") continue;
          const n = diag.findNodeForData(d);
          if (supers.has(n)) return false;
        }
        return true;
      }

      // implementations of doLayout that do not make use of a LayoutNetwork
      // need to perform their own transactions
      this.diagram.startTransaction("Custom Layout");

      while (supers.count > 0) {
        let ready = null;
        const it = supers.iterator;
        while (it.next()) {
          if (isReady(it.value, supers, this.diagram)) {
            ready = it.value;
            break;
          }
        }
        supers.remove(ready);
        const b = this.diagram.computePartsBounds(membersOf(ready, this.diagram));
        ready.location = b.position;
        const body = ready.findObject("BODY");
        if (body) body.desiredSize = b.size;
      }

      this.diagram.commitTransaction("Custom Layout");
    }
  }
  // end CustomLayout


  // Define a custom DraggingTool
  class CustomDraggingTool extends go.DraggingTool {
    moveParts(parts, offset, check) {
      super.moveParts(parts, offset, check);
      this.diagram.layoutDiagram(true);
    }

    computeEffectiveCollection(parts) {
      const coll = new go.Set(/*go.Part*/).addAll(parts);
      parts.each(p => this.walkSubTree(p, coll));
      return super.computeEffectiveCollection(coll);
    };

    // Find other attached nodes.
    walkSubTree(sup, coll) {
      if (sup === null) return;
      coll.add(sup);
      if (sup.category !== "Super") return;
      // recurse through this super state's members
      const model = this.diagram.model;
      const mems = sup.data._members;
      if (mems) {
        for (let i = 0; i < mems.length; i++) {
          const mdata = mems[i];
          this.walkSubTree(this.diagram.findNodeForData(mdata), coll);
        }
      }
    }
  }
  // end CustomDraggingTool class

    // Show the diagram's model in JSON format
    function save() {
      document.getElementById("mySavedModel").value = myDiagram.model.toJson();
      myDiagram.isModified = false;
    }
    function load() {
      myDiagram.model = go.Model.fromJson(document.getElementById("mySavedModel").value);

      // make sure all data have up-to-date "members" collections
      // this does not prevent any "cycles" of membership, which would result in undefined behavior
      const arr = myDiagram.model.nodeDataArray;
      for (let i = 0; i < arr.length; i++) {
        const data = arr[i];
        const supers = data.supers;
        if (supers) {
          for (let j = 0; j < supers.length; j++) {
            const sdata = myDiagram.model.findNodeDataForKey(supers[j]);
            if (sdata) {
              // update _supers to be an Array of references to node data
              if (!data._supers) {
                data._supers = [sdata];
              } else {
                data._supers.push(sdata);
              }
              // update _members to be an Array of references to node data
              if (!sdata._members) {
                sdata._members = [data];
              } else {
                sdata._members.push(data);
              }
            }
          }
        }
      }
    }
    window.addEventListener('DOMContentLoaded', init);
  </script>

<div id="sample">
  <div id="myDiagramDiv" style="border: 1px solid black; width: 100%; height: 800px; position: relative; -webkit-tap-highlight-color: rgba(255, 255, 255, 0);"><canvas tabindex="0" width="1054" height="398" style="position: absolute; top: 0px; left: 0px; z-index: 2; user-select: none; touch-action: none; width: 1054px; height: 398px;"></canvas><div style="position: absolute; overflow: auto; width: 1054px; height: 398px; z-index: 1;"><div style="position: absolute; width: 1px; height: 1px;"></div></div></div>
   

  <button id="SaveButton" onclick="save()">Save</button>
  <button onclick="load()">Load</button>
  Diagram Model saved in JSON format:
  <br>
  <textarea id="mySavedModel" style="width:100%;height:300px">
{ "class": "GraphLinksModel",
  "nodeDataArray": [
{"key":-1,"text":"GCP","category":"Super"},
{"key":-10,"text":"VPC","category":"Super","supers":[-1]},
{"key":-7,"text":"Identity_Security","category":"Super","supers":[-3]},
{"key":-2,"text":"Region1","category":"Super","supers":[-10]},
{"key":-3,"text":"Zone1","category":"Super","supers":[-2]},
{"key":-4,"text":"Compute","category":"Super","supers":[-7]},
{"key":-11,"text":"ComputeEngine","category":"Super","supers":[-4]},
{"key":-8,"text":"Zone2","category":"Super","supers":[-2]},
{"key":-9,"text":"Region2","category":"Super","supers":[-10]},
{"key":-13,"text":"Storage","category":"Super","supers":[-7]},
{"key":-14,"text":"Database","category":"Super","supers":[-7]},
{"key":-15,"text":"SQL","category":"Super","supers":[-14]},
{"key":-16,"text":"NOSQL","category":"Super","supers":[-14]},
{"key":-17,"text":"CloudStore","category":"Super","supers":[-13]},
{"key":-18,"text":"BlockStore","category":"Super","supers":[-13]},
{"key":-19,"text":"IAM","category":"Super","supers":[-7]},
{"key":-20,"text":"Account","category":"Super","supers":[-19]},
{"key":-21,"text":"Roles","category":"Super","supers":[-19]},
{"key":-22,"text":"Billing","category":"Super","supers":[-19]},
{"key":-12,"text":"AWS","category":"Super"},
{"key":4.2,"loc":"812.9999999999981 -85.00000000000013","text":"Resources","supers":[-8]},
{"key":-28,"loc":"938.0000000000048 -115.99999999999989","text":"Zones","supers":[-9]},
{"key":-29,"loc":"1113.9999999999986 43.000000000000064","text":"AWS Resources","supers":[-12]},
{"key":-30,"loc":"-491 11","text":"Preemptible VMS","supers":[-11]},
{"key":-31,"loc":"-505 98","text":"Instance Templates","supers":[-11]},
{"key":-39,"loc":"-471 201","text":"GKE","supers":[-4]},
{"key":-40,"loc":"-486 152","text":"CloudRun","supers":[-4]},
{"key":-43,"loc":"-486 152","text":"Container Engine","supers":[-4]},
{"key":-44,"loc":"-486 152","text":"Container Registry","supers":[-4]},
{"key":-32,"loc":"-513 57","text":"Managed Instance Groups","supers":[-11]},
{"key":-47,"loc":"147.9999999999991 140.00000000000006","text":"FileStore","supers":[-13]},
{"key":-23,"loc":"-149.00000000000045 30.000000000000043","text":"CloudSQL","supers":[-15]},
{"key":-26,"loc":"-149.00000000000045 90.00000000000013","text":"CloudSpanner","supers":[-15]},
{"key":-24,"loc":"-279 9","text":"BigTable","supers":[-16]},
{"key":-27,"loc":"-279 59","text":"DataStore","supers":[-16]},
{"key":-33,"loc":"-279 109","text":"FireStore","supers":[-16]},
{"key":-34,"loc":"-279 159","text":"MemoryStore","supers":[-16]},
{"key":-48,"loc":"662.0000000000015 39.999999999999496","text":"Discounts","supers":[-22]},
{"key":-45,"loc":"525.9999999999981 38.00000000000017","text":"MemoryStore","supers":[-21]},
{"key":-46,"loc":"389.99999999999795 46.00000000000024","text":"MemoryStore","supers":[-20]},
{"key":-35,"loc":"22.999999999998636 14.000000000000036","text":"Standard","supers":[-17]},
{"key":-36,"loc":"21.99999999999818 53.00000000000017","text":"Nearline","supers":[-17]},
{"key":-37,"loc":"27.99999999999841 94.00000000000003","text":"Codeline","supers":[-17]},
{"key":-38,"loc":"31.999999999998863 135.9999999999997","text":"Archive","supers":[-17]},
{"key":-41,"loc":"127.99999999999841 21.999999999999574","text":"Local Disk(physically attached)","supers":[-18]},
{"key":-42,"loc":"139.9999999999983 70.99999999999959","text":"Persistent Disk(Snapshot)","supers":[-18]}
],
  "linkDataArray": [{"from":-1,"to":-12}]}
</textarea>
  </body>
  </html>
